(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{407:function(e,r,n){"use strict";n.r(r),n.d(r,{RenderPromises:function(){return u},getDataFromTree:function(){return s},getMarkupFromTree:function(){return a},renderToStringWithData:function(){return c}});var t=n(655),o=n(7294),i=n(4273);var u=function(){function e(){this.queryPromises=new Map,this.queryInfoTrie=new Map}return e.prototype.clear=function(){this.queryPromises.clear(),this.queryInfoTrie.clear()},e.prototype.registerSSRObservable=function(e,r){this.lookupQueryInfo(r).observable=e},e.prototype.getSSRObservable=function(e){return this.lookupQueryInfo(e).observable},e.prototype.addQueryPromise=function(e,r){return this.lookupQueryInfo(e.getOptions()).seen?r():(this.queryPromises.set(e.getOptions(),new Promise((function(r){r(e.fetchData())}))),null)},e.prototype.hasPromises=function(){return this.queryPromises.size>0},e.prototype.consumeAndAwaitPromises=function(){var e=this,r=[];return this.queryPromises.forEach((function(n,t){e.lookupQueryInfo(t).seen=!0,r.push(n)})),this.queryPromises.clear(),Promise.all(r)},e.prototype.lookupQueryInfo=function(e){var r=this.queryInfoTrie,n=e.query,t=e.variables,o=r.get(n)||new Map;r.has(n)||r.set(n,o);var i=JSON.stringify(t),u=o.get(i)||{seen:!1,observable:null};return o.has(i)||o.set(i,u),u},e}();function s(e,r){return void 0===r&&(r={}),a({tree:e,context:r,renderFunction:n(7762).renderToStaticMarkup})}function a(e){var r=e.tree,s=e.context,a=void 0===s?{}:s,c=e.renderFunction,f=void 0===c?n(7762).renderToStaticMarkup:c,p=new u;return Promise.resolve().then((function e(){var n=(0,i.K)();return new Promise((function(e){var i=o.createElement(n.Provider,{value:(0,t.pi)((0,t.pi)({},a),{renderPromises:p})},r);e(f(i))})).then((function(r){return p.hasPromises()?p.consumeAndAwaitPromises().then(e):r})).finally((function(){p.clear()}))}))}function c(e){return a({tree:e,renderFunction:n(7762).renderToString})}},6603:function(e,r,n){e.exports=n(407)}}]);